<#import "/views/layout/defaultLayout.ftl.html" as layout>
<@layout.defaultLayout i18n("signInTitle")>

<style type="text/css">
    .ssoSigninFormContainer {
        min-width: 400px;
    }
    .ssoSigninCaptchaContainer {
        text-align: left;
    }
</style>

<div class="row">
    <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8">
        <h3>
            ${i18n("signInTitle")}
        </h3>

        <#if status??>
        <div class="alert alert-<#if statusSuccess>success<#else>danger</#if>">${status}</div>
        </#if>
        
        <#if errors.hasBeanViolation('emailNotConfirmed')>
        <div class="alert alert-danger">${i18n("signInEmailNotConfirmedMessage")}</div>
        <#elseif errors.hasBeanViolation('emailOrPassword')>
        <div class="alert alert-danger">${i18n("signInEmailOrPasswordNotFound")}</div>
        <#elseif errors.hasBeanViolations()>
        <div class="alert alert-danger">${i18n("signInFixTheErrorsAlert")}</div>
        </#if>

        <form role="form" id="signInForm" method="POST" action="${contextPath}/signin?lang=${lang?url}&project=${project?url}&redirectUrl=${redirectUrl?url}">
            <div class="form-group">
                <label for="email">${i18n("signInEmailAddress")}</label>
                <input type="email"  id="email" name="email" placeholder="${i18n("signInEmailPlaceHolder")}" value="${user.email}" 
                       ${_enableHtml5Required}
                       class="form-control <#if errors.hasBeanViolation('emailOrPassword') || errors.hasBeanViolation('email')>ssoFieldError</#if>" />
            </div>
            <div class="form-group">
                <label for="password">${i18n("signInPassword")}</label>
                <input type="password" id="password" name="password" 
                       placeholder="${i18n("signInPasswordPlaceHolder")}"
                       value="${user.password}" ${_enableHtml5Required}
                       class="form-control <#if errors.hasBeanViolation('emailOrPassword') || errors.hasBeanViolation('password')>ssoFieldError</#if>" />
            </div>
            <#if ipHitsExceeded>
            <div class="row">
                <div class="col-xs-6 col-md-6">
                    <div class="form-group">
                        <label for="captchaCode">${i18n("signInCaptchaCode")}</label>
                        <input type="text" autocomplete="off"  class="form-control" id="captchaCode" 
                               name="captchaCode"  ${_enableHtml5Required}
                               placeholder="${i18n("signInCaptchaCodePlaceHolder")}" />
                               <#if errors.hasBeanViolation('captchaCode')> 
                               <p class="help-block ssoFieldErrorDescription">     
                            ${i18n("signInCaptchaCodeRequired")} 
                        </p> 
                        </#if>
                    </div>
                </div>
                <div class="col-xs-6 col-md-6 ssoSigninCaptchaContainer">
                    <img src="${captchaUrl}" class="ssoCaptchaImage" alt="captcha code" onclick="this.src = this.src + '&.c=' + Math.random();"/>
                    <#if errors.hasBeanViolation('captchaCode')>
                    <p class="help-block">${i18n("signInCaptchaCodeHelp")}</p>
                    </#if>
                </div>
            </div>
            <input type="hidden" value="${token}" name="token" />
            </#if>
            <button type="submit" class="btn btn-default" id="signInSubmit">${i18n("signInButtonTitle")}</button>
        </form>
    </div>
    <div class="col-sm-4 col-md-4 col-lg-4 ssoSignupRight">
        <h3 class="ssoHeader">
            ${i18n("signUpForgotPassword")}
        </h3>
        <p>
            ${i18n("signUpForgotPasswordTextPrefix")}
            <a href="${contextPath}/signin/forgot?lang=${lang}&project=${project?url}&redirectUrl=${redirectUrl?url}">${i18n("forgotPasswordRestoreLinkTitle")}</a>
            ${i18n("signUpForgotPasswordTextPostfix")}
        </p>
        <h3 class="ssoHeader">
            ${i18n("signInNoAccount")}
        </h3>
        <p>
            ${i18n("signInNoAccountTextPrefix")}
            <a href="${contextPath}/signup?lang=${lang}&project=${project?url}&redirectUrl=${redirectUrl?url}">${i18n("signInNoAccountLink")}</a>
            ${i18n("signInNoAccountTextPostfix")}
        </p>
    </div>
</div>
<div class="x-meople-boot-body"></div>

<script>
    $('#email, #captchaCode').keyup(function() {
        var v = this.value, vv = v.replace(/^[\s]+/, '');
        if (v != vv) this.value = vv;
    });
    $('#signInForm').submit(function() {
        $('#signInSubmit').attr('disabled', 'disabled');
        $('#signInSubmit').html('${i18n("signInButtonTitleLoading")}');
    });
</script>

</@layout.defaultLayout>
